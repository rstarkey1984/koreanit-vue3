<!doctype html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IT 뉴스</title>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="app" class="wrap">
    <div class="top">
      <div class="title">
        <h1>IT 뉴스</h1>
        <div class="subtitle">
          Source: <b>{{ meta.source || '-' }}</b>
          <span v-if="meta.updatedAt"> · Updated: {{ formatDateTime(meta.updatedAt) }}</span>
          <span v-if="meta.count"> · Count: {{ meta.count }}</span>
        </div>
      </div>

      <div class="controls">
        <span class="authBadge" :class="hasToken ? 'on' : 'off'">
          <span class="dot"></span>
          <span v-if="hasToken">로그인됨</span>
          <span v-else>비로그인</span>
        </span>

        <button class="btn" type="button" @click="promptLogin">
          로그인
        </button>

        <button class="btn" type="button" @click="logout" :disabled="!hasToken">
          로그아웃
        </button>

        <button class="btn" type="button" @click="callMe" :disabled="!hasToken">
          /me 확인
        </button>

        <input class="input" v-model.trim="q" placeholder="제목/언론사 검색" />
        <select class="select" v-model="sort">
          <option value="latest">최신순</option>
          <option value="oldest">오래된순</option>
          <option value="publisher">언론사순</option>
          <option value="title">제목순</option>
        </select>

        <button class="chip" type="button" @click="toggleOnlyFav" :aria-pressed="onlyFav">
          ★ 즐겨찾기만
        </button>

        <button class="btn" @click="reload" :disabled="loading">
          {{ loading ? '불러오는 중...' : '새로고침' }}
        </button>
      </div>
    </div>

    <div class="panel">
      <div class="meta">
        <div>
          표시: <strong>{{ filteredItems.length }}</strong> / {{ items.length }}
          <span class="muted">· 읽음 {{ readCount }} · 즐겨찾기 {{ favCount }}</span>
        </div>

        <div class="right">
          <button class="btn" type="button" @click="clearRead" :disabled="readCount === 0">
            읽음 초기화
          </button>
          <button class="btn" type="button" @click="clearFav" :disabled="favCount === 0">
            즐겨찾기 초기화
          </button>
        </div>
      </div>

      <div v-if="loading" class="grid">
        <div class="skeleton" v-for="n in 6" :key="n"></div>
      </div>

      <div v-else-if="filteredItems.length === 0" class="status">
        표시할 뉴스가 없습니다.
      </div>

      <div v-else class="grid">
        <article class="card" v-for="it in filteredItems" :key="it.id" :class="{ read: isRead(it.id) }">
          <div class="readMark" v-if="isRead(it.id)">읽음</div>

          <h3>
            <a :href="it.link" target="_blank" rel="noopener noreferrer" @click="markRead(it.id)">
              {{ it.title }}
            </a>
          </h3>

          <div class="row">
            <span class="badge">{{ it.publisher || 'Unknown' }}</span>
            <div class="actions">
              <button class="iconbtn" type="button" @click="toggleFav(it.id)" :aria-pressed="isFav(it.id)"
                :title="isFav(it.id) ? '즐겨찾기 해제' : '즐겨찾기 추가'">
                <span class="star" :class="{ on: isFav(it.id) }">
                  {{ isFav(it.id) ? '★' : '☆' }}
                </span>
                <span class="muted">{{ isFav(it.id) ? '저장됨' : '저장' }}</span>
              </button>

              <span>{{ formatRssDate(it.publishedAt) }}</span>
            </div>
          </div>
        </article>
      </div>

      <div v-if="error" class="error">
        <b>에러 발생!!</b>
        <div style="margin-top: 6px; color: rgba(255, 255, 255, 0.75)">
          {{ error }}
        </div>
      </div>
    </div>
  </div>
  <script src="vue.js"></script>
</body>

</html>